<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Döküm Kayıt Formu</title>
    <style>
        .matrix-container {
            display: inline-block;
            border: 1px solid #999;
            margin-top: 10px;
        }

        .matrix-labels {
            display: grid;
            grid-template-columns: 30px repeat(7, 30px);
        }

        .matrix-labels div {
            text-align: center;
            font-weight: bold;
        }

        .matrix {
            display: grid;
            grid-template-columns: 30px repeat(7, 30px);
        }

        .cell {
            width: 30px;
            height: 30px;
            background-color: lightgray;
            border: 1px solid #999;
            cursor: pointer;
            text-align: center;
            line-height: 30px;
            font-size: 14px;
        }

        .fail {
            background-color: lightcoral;
        }
    </style>
</head>
<body>
    <h2>Döküm Kayıt Formu</h2>
    <form method="POST">
        <label>Tarih:</label><br>
        <input type="date" name="tarih" required><br><br>

        <label>Döküm No:</label><br>
        <input type="text" name="dokum_no" required><br><br>

        <label>Alaşım:</label><br>
        <input type="text" name="alasim" required><br><br>

        <label>Sıcaklık (°C):</label><br>
        <input type="text" name="sicaklik"><br><br>

        <label>Kalıp Durumu (Başarısızları seç):</label><br>

        <div class="matrix-container">
            <div class="matrix-labels">
                <div></div>
                <div>A</div><div>B</div><div>C</div><div>D</div><div>E</div><div>F</div><div>G</div>
            </div>
            <div class="matrix" id="matrix">
                {% for i in range(6) %}
                    <div><strong>{{ i + 1 }}</strong></div>
                    {% for j in range(7) %}
                        <div class="cell" onclick="toggleCell(this)" data-label="{{ i + 1 }}{{ 'ABCDEFG'[j] }}"></div>
                    {% endfor %}
                {% endfor %}
            </div>
        </div>

        <input type="hidden" name="kalip" id="kalipInput">

        <br><br>
        <label>Notlar:</label><br>
        <textarea name="notlar"></textarea><br><br>

        <button type="submit">Kaydet</button>
    </form>

    <script>
        const matrix = document.getElementById("matrix");
        const input = document.getElementById("kalipInput");

        function toggleCell(cell) {
            cell.classList.toggle("fail");
            updateMatrixInput();
        }

        function updateMatrixInput() {
            const cells = matrix.querySelectorAll(".cell");
            const failed = Array.from(cells)
                .filter(cell => cell.classList.contains("fail"))
                .map(cell => cell.dataset.label);

            const total = cells.length;
            const failCount = failed.length;
            const successCount = total - failCount;

            input.value = `Başarılı: ${successCount}/${total} | Başarısız: ${failCount} | Hatalı Kalıplar: ${failed.join(", ")}`;
        }
    </script>
</body>
</html>
